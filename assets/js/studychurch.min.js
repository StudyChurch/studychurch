/*! StudyChurch - v0.1.0 - 2015-07-22
 * http://wordpress.org/themes
 * Copyright (c) 2015; * Licensed GPLv2+ */
(function(e){"use strict";var t=function(e){var t=this;t.init=function(){t.$container=e,t.$form=t.$container.find("form"),t.$form.length&&t.$form.on("submit",t.handleSubmission)},t.handleSubmission=function(e){e.preventDefault(),t.data={action:t.$container.data("action"),formdata:t.$form.serialize()},wp.ajax.send(t.$container.data("action"),{success:t.response,data:t.data})},t.response=function(e){t.$form.find(".status-message").remove(),t.$form.prepend('<p class="success-message">'+e.message+"</p>"),window.location=e.url},t.init()};e(document).ready(function(){e(".ajax-form").each(function(){new t(e(this))})})})(jQuery),function(e,t){"use strict";var n=function(){var n=this;n.data={},n.init=function(t){n.$loginContainer=e(t),n.$loginContainer.length&&(n.$form=n.$loginContainer.find("form"),n.$form.on("submit",n.handleSubmission))},n.handleSubmission=function(e){var t=n.$form.attr("data-action");t&&(e.preventDefault(),n.data.log=n.$form.find('input[name="sc-login"]').val(),n.data.pwd=n.$form.find('input[name="sc-password"]').val(),n.data.security=n.$form.find('input[name="sc_login_key"]').val(),n.data.rememberme=!0,n.$form.find(".alert-box").remove(),n.$form.find(".spinner").show(),wp.ajax.send(t,{data:n.data,success:n.response,error:n.error}))},n.response=function(){n.$form.find(".spinner").hide(),n.$form.prepend('<p class="alert-box success success-message">Success! Taking you to your profile.</p>'),t.location="/profile/"},n.error=function(e){e||(e="Please make sure that you have filled in both your email and password."),n.$form.find(".spinner").hide(),n.$form.prepend('<div class="alert-box alert" data-alert>'+e+"</div>")}},i=new n;i.init("#login")}(jQuery,this),function(e,t){"use strict";var n=function(){var n=this;n.data={},n.init=function(t){n.$registerContainer=e(t),n.$registerContainer.length&&(n.$form=n.$registerContainer.find("form"),n.$form.on("submit",n.handleSubmission))},n.handleSubmission=function(e){var t=n.$form.attr("data-action");t&&(e.preventDefault(),n.data.rcp_level=n.$form.find('input[name="rcp_level"]').val(),n.data.rcp_user_first=n.$form.find('input[name="rcp_user_first"]').val(),n.data.rcp_user_last=n.$form.find('input[name="rcp_user_last"]').val(),n.data.rcp_user_login=n.$form.find('input[name="rcp_user_email"]').val(),n.data.rcp_user_email=n.$form.find('input[name="rcp_user_email"]').val(),n.data.rcp_user_pass=n.$form.find('input[name="rcp_user_pass"]').val(),n.data.rcp_user_pass_confirm=n.$form.find('input[name="rcp_user_pass"]').val(),n.data.rcp_register_nonce=n.$form.find('input[name="rcp_register_nonce"]').val(),n.$form.find(".alert-box").remove(),n.$form.find(".spinner").show(),wp.ajax.send(t,{data:n.data,success:n.response,error:n.error}))},n.response=function(){n.$form.find(".spinner").hide(),n.$form.prepend('<p class="alert-box success success-message">Success! Taking you to your profile.</p>'),t.location="/profile/"},n.error=function(e){n.$form.find(".spinner").hide(),n.$form.prepend('<div class="alert-box alert" data-alert>'+e+"</div>"),console.log(e)}},i=new n;i.init("#start-now")}(jQuery,this),jQuery(document).ready(function(e){"use strict";var t=function(e){var t=this;t.$form=e,t.data={},t.init=function(){t.$answer=t.$form.find("textarea"),t.$save=t.$form.find(".sudo-save"),t.$save.on("click",t.triggerSubmission),t.$answer.on("keyup",t.autoSave),t.$form.on("submit",t.handleSubmission)},t.autoSave=function(){console.log("keyup")},t.triggerSubmission=function(e){return e.preventDefault,t.$form.submit(),t.$save.text("Saving"),!1},t.handleSubmission=function(e){e.preventDefault(),t.data.answer=t.$form.find("textarea[name=comment]").val(),t.data.post_id=t.$form.find("input[name=comment_post_ID]").val(),t.data.comment_id=t.$form.find("input[name=comment_ID]").val(),t.data.group_id=t.$form.find("input[name=group_ID]").val(),wp.ajax.send("sc_save_answer",{success:t.success,error:t.error,data:t.data})},t.success=function(e){t.$save.text("Save"),t.$form.find("input[name=comment_ID]").val(e.comment_ID)},t.error=function(e){console.log("error"),console.log(e)},t.init()};e(document).ready(function(){e(".sc_study .comment-form").each(function(){new t(e(this))})})}),function(e,t){"use strict";e(document).foundation(),e(document).ready(function(){e(document.getElementById("single-page-navigation")).singlePageNav(),e(".study-group .content-container").outerHeight()<t.innerHeight&&e(".study-group").height(t.innerHeight-e(".top-bar-container").outerHeight()+"px"),e(".study-group #input_1_1").on("focus",function(){e(document).foundation(),e("#field_1_2").show()})})}(jQuery,this);var StudyApp=StudyApp||{};StudyApp.Models={},StudyApp.Views={},StudyApp.Collections={},StudyApp.$container=jQuery("#studyapp"),StudyApp.$content=jQuery("#studyapp-content"),StudyApp.study_id=StudyApp.$container.data("study"),StudyApp.user_id=StudyApp.$container.data("user"),StudyApp.chapter_id=null;var StudyApp=StudyApp||{};(function(e){"use strict";StudyApp.Collections.Chapter={},StudyApp.Views.Chapter={},StudyApp.Models.Chapter=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},defaults:function(){return{ID:null,id:null,title:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.study_id,menu_order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),comment_status:"closed",ping_status:"closed",order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),elements:{},sections:{}}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var i=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),i?i.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)}});var t=Backbone.Collection.extend({order:0,model:StudyApp.Models.Chapter,url:function(){return WP_API_Settings.root+"/study/"+StudyApp.study_id+"/chapters"},parse:function(e){return e},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Collections.Chapter.Sidebar=new t,StudyApp.Collections.Chapter.Single=new t,StudyApp.Views.Chapter.Sidebar=Backbone.View.extend({tagName:"li",className:function(){return"page_item page-item_"+this.model.attributes.id},template:wp.template("chapter-sidebar-template"),events:{"click a":"setupSingle"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},setupSingle:function(){return StudyApp.CurrentChapter.remove(),StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:this.model}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model),!1}}),StudyApp.Views.Chapter.Single=Backbone.View.extend({tagName:"div",className:"chapter",template:wp.template("chapter-template"),events:{"blur .chapter-title":"saveTitle"},initialize:function(){this.listenTo(this.model,"sync",this.render)},saveTitle:function(t){this.$el.find(".chapter-title").removeClass("editing");var n=e(t.target).val();n&&(this.model.url=this.model.attributes.id?WP_API_Settings.root+"/wp/v2/study/"+this.model.attributes.id:WP_API_Settings.root+"/wp/v2/study/",this.model.save({title:n}))},render:function(){return StudyApp.chapter_id=this.model.get("id"),this.$el.html(this.template(this.model.toJSON())),this}});var n=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){this.listenTo(StudyApp.Collections.Chapter.Sidebar,"add",this.addSidebarChapter),this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.fetch()},addSidebarChapter:function(e){var t=new StudyApp.Views.Chapter.Sidebar({model:e});this.$("#chapter-list").append(t.render().el)},initializeChapterEdit:function(e){StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:e}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model)},createNewChapter:function(){return this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.add(new StudyApp.Models.Chapter),!1}});StudyApp.Views.Chapter.Main=new n})(jQuery);var StudyApp=StudyApp||{};(function(){"use strict";StudyApp.Collections.Item={},StudyApp.Views.Item={},StudyApp.Models.Item=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},defaults:function(){return{ID:null,id:null,title:{rendered:""},content:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.study_id,menu_order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),comment_status:"closed",ping_status:"closed",data_type:"question_short",order:StudyApp.Collections.Chapter.Sidebar.nextOrder()}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var i=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),i?i.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)}});var e=Backbone.Collection.extend({order:0,model:StudyApp.Models.Item,url:function(){return WP_API_Settings.root+"/study/"+StudyApp.study_id+"/chapters/"+StudyApp.chapter_id},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Collections.Item=new e,StudyApp.Views.Item.List=Backbone.View.extend({tagName:"div",template:wp.template("item-template"),events:{"click .item-content-edit":"editContent"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},editContent:function(){var e=this.$el.find(".item-content"),t=this.$el.find(".panel-buttons");return t.hide(),e.editable({autosave:!0,inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","sep","indent","outdent","insertOrderedList","insertUnorderedList","sep","createLink","insertImage","fullscreen","close"],customButtons:{close:{title:"Close Editor",icon:{type:"font",value:"fa fa-compress"},callback:function(){this.destroy(),t.show()}}}}),e.on("editable.beforeSave",this.autosave),!1},autosave:function(){return!1}});var t=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-item":"createNewItem"},initialize:function(){this.listenTo(StudyApp.Collections.Item,"add",this.addItem),this.listenTo(StudyApp.Views.Chapter.Main,"renderChapter",this.setupItems)},setupItems:function(e){StudyApp.Collections.Item.reset(),StudyApp.Collections.Item.add(e.get("elements")),StudyApp.Collections.Item.url=function(){return e.urlRoot()+"/"+e.id+"/items"}},addItem:function(e){var t=new StudyApp.Views.Item.List({model:e});this.$("#chapter-items").append(t.render().el)},createNewItem:function(){return StudyApp.Collections.Item.add(new StudyApp.Models.Item),!1}});StudyApp.Views.Item.Main=new t})(jQuery);var StudyApp=StudyApp||{};(function(){"use strict";var e=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){}});StudyApp.Views.Main=new e})(jQuery);