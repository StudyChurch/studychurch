/*! StudyChurch - v0.1.0 - 2015-07-20
 * http://wordpress.org/themes
 * Copyright (c) 2015; * Licensed GPLv2+ */
(function(e){"use strict";var t=function(e){var t=this;t.init=function(){t.$container=e,t.$form=t.$container.find("form"),t.$form.length&&t.$form.on("submit",t.handleSubmission)},t.handleSubmission=function(e){e.preventDefault(),t.data={action:t.$container.data("action"),formdata:t.$form.serialize()},wp.ajax.send(t.$container.data("action"),{success:t.response,data:t.data})},t.response=function(e){t.$form.find(".status-message").remove(),t.$form.prepend('<p class="success-message">'+e.message+"</p>"),window.location=e.url},t.init()};e(document).ready(function(){e(".ajax-form").each(function(){new t(e(this))})})})(jQuery),function(e,t){"use strict";var n=function(){var n=this;n.data={},n.init=function(t){n.$loginContainer=e(t),n.$loginContainer.length&&(n.$form=n.$loginContainer.find("form"),n.$form.on("submit",n.handleSubmission))},n.handleSubmission=function(e){var t=n.$form.attr("data-action");t&&(e.preventDefault(),n.data.log=n.$form.find('input[name="sc-login"]').val(),n.data.pwd=n.$form.find('input[name="sc-password"]').val(),n.data.security=n.$form.find('input[name="sc_login_key"]').val(),n.data.rememberme=!0,n.$form.find(".alert-box").remove(),n.$form.find(".spinner").show(),wp.ajax.send(t,{data:n.data,success:n.response,error:n.error}))},n.response=function(){n.$form.find(".spinner").hide(),n.$form.prepend('<p class="alert-box success success-message">Success! Taking you to your profile.</p>'),t.location="/profile/"},n.error=function(e){e||(e="Please make sure that you have filled in both your email and password."),n.$form.find(".spinner").hide(),n.$form.prepend('<div class="alert-box alert" data-alert>'+e+"</div>")}},r=new n;r.init("#login")}(jQuery,this),function(e,t){"use strict";var n=function(){var n=this;n.data={},n.init=function(t){n.$registerContainer=e(t),n.$registerContainer.length&&(n.$form=n.$registerContainer.find("form"),n.$form.on("submit",n.handleSubmission))},n.handleSubmission=function(e){var t=n.$form.attr("data-action");t&&(e.preventDefault(),n.data.rcp_level=n.$form.find('input[name="rcp_level"]').val(),n.data.rcp_user_first=n.$form.find('input[name="rcp_user_first"]').val(),n.data.rcp_user_last=n.$form.find('input[name="rcp_user_last"]').val(),n.data.rcp_user_login=n.$form.find('input[name="rcp_user_email"]').val(),n.data.rcp_user_email=n.$form.find('input[name="rcp_user_email"]').val(),n.data.rcp_user_pass=n.$form.find('input[name="rcp_user_pass"]').val(),n.data.rcp_user_pass_confirm=n.$form.find('input[name="rcp_user_pass"]').val(),n.data.rcp_register_nonce=n.$form.find('input[name="rcp_register_nonce"]').val(),n.$form.find(".alert-box").remove(),n.$form.find(".spinner").show(),wp.ajax.send(t,{data:n.data,success:n.response,error:n.error}))},n.response=function(){n.$form.find(".spinner").hide(),n.$form.prepend('<p class="alert-box success success-message">Success! Taking you to your profile.</p>'),t.location="/profile/"},n.error=function(e){n.$form.find(".spinner").hide(),n.$form.prepend('<div class="alert-box alert" data-alert>'+e+"</div>"),console.log(e)}},r=new n;r.init("#start-now")}(jQuery,this),jQuery(document).ready(function(e){"use strict";var t=function(e){var t=this;t.$form=e,t.data={},t.init=function(){t.$answer=t.$form.find("textarea"),t.$save=t.$form.find(".sudo-save"),t.$save.on("click",t.triggerSubmission),t.$answer.on("keyup",t.autoSave),t.$form.on("submit",t.handleSubmission)},t.autoSave=function(){console.log("keyup")},t.triggerSubmission=function(e){return e.preventDefault,t.$form.submit(),t.$save.text("Saving"),!1},t.handleSubmission=function(e){e.preventDefault(),t.data.answer=t.$form.find("textarea[name=comment]").val(),t.data.post_id=t.$form.find("input[name=comment_post_ID]").val(),t.data.comment_id=t.$form.find("input[name=comment_ID]").val(),t.data.group_id=t.$form.find("input[name=group_ID]").val(),wp.ajax.send("sc_save_answer",{success:t.success,error:t.error,data:t.data})},t.success=function(e){t.$save.text("Save"),t.$form.find("input[name=comment_ID]").val(e.comment_ID)},t.error=function(e){console.log("error"),console.log(e)},t.init()};e(document).ready(function(){e(".sc_study .comment-form").each(function(){new t(e(this))})})}),function(e,t){"use strict";e(document).foundation(),e(document).ready(function(){e(document.getElementById("single-page-navigation")).singlePageNav(),e(".study-group .content-container").outerHeight()<t.innerHeight&&e(".study-group").height(t.innerHeight-e(".top-bar-container").outerHeight()+"px"),e(".study-group #input_1_1").on("focus",function(){e(document).foundation(),e("#field_1_2").show()})})}(jQuery,this);var StudyApp=StudyApp||{};StudyApp.$container=jQuery("#studyapp"),StudyApp.$content=jQuery("#studyapp-content"),StudyApp.study_id=StudyApp.$container.data("study"),StudyApp.user_id=StudyApp.$container.data("user");var StudyApp=StudyApp||{};(function(e){"use strict";StudyApp.Chapter=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},defaults:function(){return{ID:null,title:"New Chapter",status:"publish",type:"sc_study",author:new wp.api.models.User,content:"",parent:StudyApp.study_id,link:"",date:new Date,modified:new Date,date_gmt:new Date,modified_gmt:new Date,date_tz:"Etc/UTC",modified_tz:"Etc/UTC",format:"standard",slug:"",guid:"",excerpt:"&nbsp;",menu_order:StudyApp.Chapters.nextOrder(),comment_status:"closed",ping_status:"open",sticky:!1,password:"",meta:{links:{}},featured_image:null,terms:[],order:StudyApp.Chapters.nextOrder()}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var r=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),r?r.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)},toggle:function(){this.save({done:!this.get("done")})}});var t=Backbone.Collection.extend({order:0,model:StudyApp.Chapter,url:function(){return WP_API_Settings.root+"/study/"+StudyApp.study_id+"/chapters"},parse:function(e){return e},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Chapters=new t,StudyApp.ChapterSingle=new t,StudyApp.ChapterViewSidebar=Backbone.View.extend({tagName:"li",className:function(){return"page_item page-item_"+this.model.attributes.id},template:wp.template("chapter-sidebar-template"),events:{"click a":"setupSingle"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},setupSingle:function(){return StudyApp.CurrentChapter.remove(),StudyApp.CurrentChapter=new StudyApp.ChapterView({model:this.model}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.$content.fadeIn(),!1}}),StudyApp.ChapterView=Backbone.View.extend({tagName:"div",className:"chapter",template:wp.template("chapter-template"),events:{"blur .chapter-title":"saveTitle","click .chapter-title-edit":"editTitle"},editTitle:function(){return this.$el.find(".chapter-title").addClass("editing").find("input").focus(),!1},saveTitle:function(t){this.$el.find(".chapter-title").removeClass("editing");var n=e(t.target).val();n&&(this.model.url=WP_API_Settings.root+"/wp/v2/study/"+this.model.attributes.id,this.model.save({title:n}))},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})})(jQuery);var StudyApp=StudyApp||{};(function(e){"use strict";var t=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){this.input=this.$("#new-chapter"),this.listenTo(StudyApp.Chapters,"add",this.addChapter),this.listenToOnce(StudyApp.Chapters,"add",this.initializeChapterEdit),this.listenTo(StudyApp.ChapterSingle,"add",this.setupChapter),StudyApp.Chapters.fetch()},addChapter:function(e){var t=new StudyApp.ChapterViewSidebar({model:e});this.$("#chapter-list").append(t.render().el)},initializeChapterEdit:function(e){StudyApp.CurrentChapter=new StudyApp.ChapterView({model:e}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.$content.fadeIn()},setupChapter:function(e){StudyApp.CurrentChapter.model.set(e)},createNewChapter:function(){return this.listenTo(StudyApp.Chapters,"add",this.setupChapter),StudyApp.Chapters.create(),!1},editChapter:function(t){var n=e(t.target),r=n.data("chapter");return this.$("#chapter-list a").removeClass("current"),n.addClass("current"),StudyApp.ChapterSingle.url=StudyApp.Chapters.url()+"/"+r,StudyApp.ChapterSingle.fetch(),!1}});StudyApp.AppView=new t})(jQuery);