/*! StudyChurch - v0.1.0 - 2015-08-08
 * http://wordpress.org/themes
 * Copyright (c) 2015; * Licensed GPLv2+ */
(function(e){"use strict";var t=function(e){var t=this;t.init=function(){t.$form=e,t.$form.length&&t.$form.on("submit",t.handleSubmission)},t.handleSubmission=function(e){e.preventDefault(),t.data={action:"sc_ajax_form",formdata:t.$form.serialize()},wp.ajax.send("sc_ajax_form",{success:t.response,error:t.error,data:t.data})},t.response=function(e){t.$form.find(".status-message").remove(),t.$form.prepend('<p class="success-message">'+e.message+"</p>"),e.url&&(window.location=e.url)},t.error=function(e){t.$form.find(".spinner").hide(),t.$form.find(".alert-box").remove(),t.$form.prepend('<div class="alert-box alert" data-alert>'+e.message+"</div>"),console.log(e)},t.init()};e(document).ready(function(){e(".ajax-form").each(function(){new t(e(this))})})})(jQuery),function(e,t){"use strict"}(jQuery,this),function(e,t){"use strict"}(jQuery,this),jQuery(document).ready(function(e){"use strict";var t=function(e){var t=this;t.$form=e,t.data={},t.init=function(){t.$answer=t.$form.find("textarea"),t.$save=t.$form.find(".sudo-save"),t.$save.on("click",t.triggerSubmission),t.$answer.on("keyup keydown",t.autoGrow),t.$form.on("submit",t.handleSubmission)},t.autoGrow=function(e){var t=e.target;t.style.height=t.scrollHeight+"px"},t.triggerSubmission=function(e){return e.preventDefault,t.$form.submit(),t.$save.text("Saving"),!1},t.handleSubmission=function(e){e.preventDefault(),t.data.answer=t.$form.find("textarea[name=comment]").val(),t.data.post_id=t.$form.find("input[name=comment_post_ID]").val(),t.data.comment_id=t.$form.find("input[name=comment_ID]").val(),t.data.group_id=t.$form.find("input[name=group_ID]").val(),wp.ajax.send("sc_save_answer",{success:t.success,error:t.error,data:t.data})},t.success=function(e){t.$save.text("Save"),t.$form.find("input[name=comment_ID]").val(e.comment_ID)},t.error=function(e){console.log("error"),console.log(e)},t.init()};e(document).ready(function(){e(".sc_study .comment-form").each(function(){new t(e(this))}),e(".study-answers.activity").on("click",".toggle-comments",function(t){var n=e(t.target);return n.parents(".groups").toggleClass("comments-hide"),!1}),e(".activity-list-others").on("click",".toggle-answers",function(t){var n=e(t.target);return n.parents(".activity-list-others").toggleClass("answers-hide"),!1})})}),function(e){"use strict";e(document).foundation(),e(document).ready(function(){e(document.getElementById("single-page-navigation")).singlePageNav(),e(".footer-subscribe #input_1_1").on("focus",function(){e(document).foundation(),e("#field_1_2").show()});var t=e(document.getElementById("restricted-message"));if(t.length){var n=t.find("#login"),i=t.find("#start-now");n.find(".switch").on("click",function(){n.fadeOut(function(){i.fadeIn()})}),i.find(".switch").on("click",function(){i.fadeOut(function(){n.fadeIn()})})}})}(jQuery,this);var StudyApp=StudyApp||{};StudyApp.Models={},StudyApp.Views={},StudyApp.Collections={},StudyApp.$container=jQuery("#studyapp"),StudyApp.$content=jQuery("#studyapp-content"),StudyApp.study_id=StudyApp.$container.data("study"),StudyApp.user_id=StudyApp.$container.data("user"),StudyApp.chapter_id=null;var StudyApp=StudyApp||{};(function(e){"use strict";StudyApp.Collections.Chapter={},StudyApp.Views.Chapter={},StudyApp.Models.Chapter=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},url:function(){return this.get("id")?this.urlRoot()+this.get("id"):this.urlRoot()},defaults:function(){return{ID:null,id:null,title:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.study_id,menu_order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),comment_status:"closed",ping_status:"closed",order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),elements:{},sections:{}}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var i=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),i?i.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)}});var t=Backbone.Collection.extend({order:0,model:StudyApp.Models.Chapter,url:function(){return WP_API_Settings.root+"/study/"+StudyApp.study_id+"/chapters/"},parse:function(e){return e},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Collections.Chapter.Sidebar=new t,StudyApp.Collections.Chapter.Single=new t,StudyApp.Views.Chapter.Sidebar=Backbone.View.extend({tagName:"li",className:function(){return"page_item page-item_"+this.model.attributes.id},template:wp.template("chapter-sidebar-template"),events:{"click a":"setupSingle"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},setupSingle:function(){return StudyApp.CurrentChapter.remove(),StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:this.model}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model),!1}}),StudyApp.Views.Chapter.Single=Backbone.View.extend({tagName:"div",className:"chapter",template:wp.template("chapter-template"),events:{"blur .chapter-title":"saveTitle","click .chapter-delete":"deleteChapter"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},saveTitle:function(t){this.$el.find(".chapter-title").removeClass("editing");var n=e(t.target).val();n&&this.model.save({title:n})},deleteChapter:function(){return window.confirm("Are you sure you want to delete this chapter and all its items?")?(this.model.destroy(),!1):void 0},render:function(){return StudyApp.chapter_id=this.model.get("id"),this.$el.html(this.template(this.model.toJSON())),this}});var n=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){StudyApp.$container.length&&(this.listenTo(StudyApp.Collections.Chapter.Sidebar,"add",this.addSidebarChapter),this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.fetch())},addSidebarChapter:function(e){var t=new StudyApp.Views.Chapter.Sidebar({model:e});this.$("#chapter-list").append(t.render().el)},initializeChapterEdit:function(e){StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:e}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model)},createNewChapter:function(){return this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.add(new StudyApp.Models.Chapter),!1}});StudyApp.Views.Chapter.Main=new n})(jQuery);var StudyApp=StudyApp||{};(function(e){"use strict";StudyApp.Collections.Item={},StudyApp.Views.Item={},StudyApp.Models.Item=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},url:function(){return this.attributes.id?this.urlRoot()+this.get("id"):this.url=this.urlRoot()},defaults:function(){return{ID:null,id:null,title:{rendered:""},content:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.chapter_id,menu_order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),comment_status:"open",ping_status:"closed",data_type:"question_short",order:StudyApp.Collections.Chapter.Sidebar.nextOrder()}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var i=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),i?i.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)}});var t=Backbone.Collection.extend({order:0,model:StudyApp.Models.Item,url:function(){return WP_API_Settings.root+"/study/"+StudyApp.study_id+"/chapters/"+StudyApp.chapter_id+"/items/"},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Collections.Item=new t,StudyApp.Views.Item.List=Backbone.View.extend({tagName:"div",template:wp.template("item-template"),events:{"click .item-compress":"compress","click .item-expand":"expand","click .item-content-edit":"editContent","click .item-content-delete":"deleteItem","change .item-data-type":"setDataType"},initialize:function(){this.listenTo(this.model,"destroy",this.handleDestroy)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},compress:function(){return this.$el.find(".panel").addClass("compressed"),!1},expand:function(){return this.$el.find(".panel").removeClass("compressed"),!1},editContent:function(){var e=this.$el.find(".item-content"),t=this.$el.find(".panel-buttons");return t.hide(),e.editable({autosave:!0,autosaveInterval:2500,inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","sep","indent","outdent","insertOrderedList","insertUnorderedList","sep","createLink","insertImage","fullscreen","close"],customButtons:{close:{title:"Close Editor",icon:{type:"font",value:"fa fa-save"},callback:function(){this.save(),this.destroy(),t.show()}}}}),e.on("editable.beforeSave",this,this.autosave),!1},setDataType:function(t){return this.setsave({data_type:e(t.target).val()}),!1},autosave:function(e,t){var n=e.data,i=n.model.get("content");return i.raw=t.getHTML(),n.setsave({content:i}),!1},setsave:function(e,t){this.model.save(e),!1!==t&&StudyApp.CurrentChapter.model.fetch()},deleteItem:function(){return window.confirm("Are you sure you want to delete this item?")?(this.model.destroy(),!1):void 0},handleDestroy:function(){this.remove(),StudyApp.CurrentChapter.model.fetch()}});var n=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-item":"createNewItem"},initialize:function(){this.listenTo(StudyApp.Collections.Item,"add",this.addItem),this.listenTo(StudyApp.Views.Chapter.Main,"renderChapter",this.setupItems)},setupItems:function(t){StudyApp.Collections.Item.reset();var n=t.get("elements");e.isEmptyObject(n)||(StudyApp.Collections.Item.add(t.get("elements")),StudyApp.Collections.Item.url=function(){return t.urlRoot()+t.id+"/items/"})},addItem:function(e){var t=new StudyApp.Views.Item.List({model:e});this.$("#chapter-items").append(t.render().el),e.get("content")&&!e.get("content").rendered&&t.editContent()},createNewItem:function(){return StudyApp.Collections.Item.add(new StudyApp.Models.Item),!1}});StudyApp.Views.Item.Main=new n})(jQuery);var StudyApp=StudyApp||{};(function(){"use strict";var e=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){}});StudyApp.Views.Main=new e})(jQuery);