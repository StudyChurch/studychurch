/*! StudyChurch - v0.1.0 - 2017-08-10
 * http://wordpress.org/themes
 * Copyright (c) 2017; * Licensed GPLv2+ */
!function(a){"use strict";var b=function(a){var b=this;b.processing=!1,b.init=function(){b.$form=a,b.$form.length&&(b.$button=b.$form.find("input[type=submit]"),b.$form.on("submit",b.handleSubmission))},b.handleSubmission=function(a){return a.preventDefault(),!b.processing&&(b.data={action:"sc_ajax_form",formdata:b.$form.serialize()},b.startProcessing(),void wp.ajax.send("sc_ajax_form",{success:b.response,error:b.error,data:b.data}))},b.response=function(a){b.finishProcessing(a.message,!0),a.url&&(window.location=a.url)},b.error=function(a){b.finishProcessing("Ooops! Something went wrong, please try again.",!1),b.$form.prepend('<div class="alert-box alert" data-alert>'+a.message+"</div>"),console.log(a)},b.startProcessing=function(){b.processing=!0,b.$form.find(".alert-box").remove(),b.$button.val("Processing...").removeClass("secondary primary alert").addClass("processing secondary")},b.finishProcessing=function(a,c){b.processing=!1,b.$button.removeClass("processing secondary primary alert").val(a),c?b.$button.addClass("primary"):b.$button.addClass("alert")},b.init()};a(document).ready(function(){a(".ajax-form").each(function(){new b(a(this))})})}(jQuery),function(a,b){"use strict"}(jQuery,this),function(a,b,c){"use strict"}(jQuery,this),jQuery(document).ready(function(a){"use strict";var b=function(b){var c=this;c.$container=b,c.data={},c.init=function(){c.$form=b.find(".comment-form"),c.$answer=c.$form.find("textarea"),c.$save=c.$form.find(".sudo-save"),c.$container.on("click",".edit-answer",c.setupCommentForm),c.$container.on("click",".toggle-comments",c.toggleComments),c.$container.on("click",".toggle-answers",c.toggleAnswers),c.$save.on("click",c.triggerSubmission),c.$answer.on("keyup keydown",c.autoGrow),c.$form.on("submit",c.handleSubmission)},c.toggleComments=function(b){var c=a(b.target);return c.parents(".groups").toggleClass("comments-hide"),!1},c.toggleAnswers=function(b){var c=a(b.target);return c.parents(".activity-list-others").toggleClass("answers-hide"),!1},c.setupCommentForm=function(a){return c.$container.find(".study-answers").remove(),c.$form.show().find("textarea").focus().select(),!1},c.autoGrow=function(a){var b=a.target;b.style.height=b.scrollHeight+"px"},c.triggerSubmission=function(a){return a.preventDefault,c.$form.submit(),c.$save.text("Saving"),!1},c.handleSubmission=function(a){a.preventDefault(),c.data.answer=c.$form.find("textarea[name=comment]").val(),c.data.post_id=c.$form.find("input[name=comment_post_ID]").val(),c.data.comment_id=c.$form.find("input[name=comment_ID]").val(),c.data.group_id=c.$form.find("input[name=group_ID]").val(),wp.ajax.send("sc_save_answer",{success:c.success,error:c.error,data:c.data})},c.success=function(a){c.$save.text("Save"),c.$form.find("input[name=comment_ID]").val(a.comment_ID),c.$form.hide(),c.$container.append(a.answers)},c.error=function(a){console.log("error"),console.log(a)},c.init()};a(document).ready(function(){a(".sc_study .study-answers-container").each(function(){new b(a(this))})})}),function(a,b,c){"use strict";a("body.group-home .toggle-comments").hide(),b.sr=new scrollReveal,a(document).foundation(),a(document).ready(function(){a(document.getElementById("single-page-navigation")).singlePageNav(),a(".login a").attr("data-reveal-id","login"),a(".sign-up a").attr("data-reveal-id","start-now"),a(".fl-pricing-table-column-0 a.fl-button").attr("data-reveal-id","start-now"),a(".fdatepicker").fdatepicker({format:"mm/dd/yyyy",disableDblClickSelection:!0}),a(".froala-min").editable({inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","underline","createLink"]}),a(".froala-default").editable({inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","underline","strikeThrough","sep","formatBlock","blockStyle","align","insertOrderedList","insertUnorderedList","outdent","indent","sep","createLink","html","fullscreen"]}),a(".froala-inline").editable({minHeight:100,buttons:["bold","italic","underline","strikeThrough","sep","formatBlock","blockStyle","align","insertOrderedList","insertUnorderedList","outdent","indent","sep","createLink"]}),a(".footer-subscribe #input_1_1").on("focus",function(){a(document).foundation(),a("#field_1_2").show()}),a(".group-invite-link").on("click",function(){a(this).select()}),a(".bug-report-button").on("click",function(){return a(this).parents(".bug-report-cont").find(".form").slideToggle(),!1});var b=a(document.getElementById("restricted-message"));if(b.length){var c=b.find("#login-body"),d=b.find("#start-now-body");c.find(".switch").on("click",function(a){return c.fadeOut(function(){d.fadeIn()}),!1}),d.find(".switch").on("click",function(a){return d.fadeOut(function(){c.fadeIn()}),!1})}})}(jQuery,this);var StudyApp=StudyApp||{};StudyApp.Models={},StudyApp.Views={},StudyApp.Collections={},StudyApp.$container=jQuery("#studyapp"),StudyApp.$content=jQuery("#studyapp-content"),StudyApp.study_id=StudyApp.$container.data("study"),StudyApp.user_id=StudyApp.$container.data("user"),StudyApp.chapter_id=null;var StudyApp=StudyApp||{};!function(a){"use strict";StudyApp.Collections.Chapter={},StudyApp.Views.Chapter={},StudyApp.Models.Chapter=Backbone.Model.extend({urlRoot:function(){return this.collection?this.collection.url():wpApiSettings.root+"studychurch/v1/studies/"+StudyApp.study_id+"/chapters/"},url:function(){return this.get("id")?this.urlRoot()+this.get("id"):this.urlRoot()},defaults:function(){return{ID:null,id:null,title:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.study_id,menu_order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),comment_status:"closed",ping_status:"closed",order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),elements:{},sections:{}}},sync:function(a,b,c){if(c=c||{},"undefined"!=typeof wpApiSettings.nonce){var d=c.beforeSend;c.beforeSend=function(a){if(a.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce),d)return d.apply(this,arguments)}}return Backbone.sync(a,b,c)}});var b=Backbone.Collection.extend({order:0,model:StudyApp.Models.Chapter,url:function(){return wpApiSettings.root+"studychurch/v1/studies/"+StudyApp.study_id+"/chapters/"},parse:function(a){return a},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Collections.Chapter.Sidebar=new b,StudyApp.Collections.Chapter.Single=new b,StudyApp.Views.Chapter.Sidebar=Backbone.View.extend({tagName:"li",className:function(){return"page_item page-item_"+this.model.attributes.id},template:wp.template("chapter-sidebar-template"),events:{"click a":"setupSingle"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},setupSingle:function(){return StudyApp.CurrentChapter.remove(),StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:this.model}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model),!1}}),StudyApp.Views.Chapter.Single=Backbone.View.extend({tagName:"div",className:"chapter",template:wp.template("chapter-template"),events:{"blur .chapter-title":"saveTitle","click .chapter-delete":"deleteChapter"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},saveTitle:function(b){this.$el.find(".chapter-title").removeClass("editing");var c=a(b.target).val();c&&this.model.save({title:c})},deleteChapter:function(){if(window.confirm("Are you sure you want to delete this chapter and all its items?"))return this.model.$el.remove(),this.model.destroy(),!1},render:function(){return StudyApp.chapter_id=this.model.get("id"),this.$el.html(this.template(this.model.toJSON())),this}});var c=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){StudyApp.$container.length&&(this.listenTo(StudyApp.Collections.Chapter.Sidebar,"add",this.addSidebarChapter),this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.fetch())},addSidebarChapter:function(a){var b=new StudyApp.Views.Chapter.Sidebar({model:a});a.$el=b.$el,this.$("#chapter-list").append(b.render().el),this.$("#chapter-list").sortable({update:this.sortChapters})},sortChapters:function(){StudyApp.Collections.Chapter.Sidebar.each(function(a){a.get("menu_order")!=a.$el.index()&&a.save({menu_order:a.$el.index()})})},initializeChapterEdit:function(a){StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:a}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model)},createNewChapter:function(a){return this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.add(new StudyApp.Models.Chapter),!1}});StudyApp.Views.Chapter.Main=new c}(jQuery);var StudyApp=StudyApp||{};!function(a){"use strict";StudyApp.Collections.Item={},StudyApp.Views.Item={},StudyApp.Models.Item=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},url:function(){return this.attributes.id?this.urlRoot()+this.get("id"):this.urlRoot()},defaults:function(){return{ID:null,id:null,title:{rendered:""},content:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.CurrentChapter.model.get("id"),menu_order:StudyApp.Collections.Item.nextOrder(),comment_status:"open",ping_status:"closed",data_type:"question_short",is_private:!1}},sync:function(a,b,c){if(c=c||{},"undefined"!=typeof wpApiSettings.nonce){var d=c.beforeSend;c.beforeSend=function(a){if(a.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce),d)return d.apply(this,arguments)}}return Backbone.sync(a,b,c)}});var b=Backbone.Collection.extend({menu_order:0,model:StudyApp.Models.Item,url:function(){return wpApiSettings.root+"studychurch/v1/studies/"+StudyApp.study_id+"/chapters/"+StudyApp.CurrentChapter.model.get("id")+"/items/"},nextOrder:function(){return this.length?this.menu_order=this.last().get("menu_order")+1:this.menu_order++,this.menu_order},comparator:"menu_order"});StudyApp.Collections.Item=new b,StudyApp.Views.Item.List=Backbone.View.extend({tagName:"li",className:function(){return"panel item-"+this.model.get("id")+" "+this.model.get("data_type")},template:wp.template("item-template"),events:{"click .item-compress":"compress","click .item-expand":"expand","click .item-content-edit":"editContent","click .item-content-delete":"deleteItem","click .item-content-save":"saveItem","click .item-privacy":"setPrivacy","change .item-data-type":"setDataType"},initialize:function(){this.listenTo(this.model,"destroy",this.handleDestroy),this.listenTo(this.model,"save",this.handleDestroy)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},compress:function(a){return this.$el.addClass("compressed"),!1},expand:function(){return this.$el.removeClass("compressed"),!1},setPrivacy:function(b){var c=a(b.target);if(c.hasClass("item-privacy")||(c=c.parent()),"question_short"!=this.model.get("data_type")&&"question_long"!=this.model.get("data_type"))return!1;if(c.hasClass("current"))return!1;this.$el.find(".item-privacy").removeClass("current"),c.addClass("current");var d=c.hasClass("item-private");return this.model.set({is_private:d}),this.model.get("id")&&this.setsave(),!1},setDataType:function(b){var c=a(b.target).val();return this.$el.removeClass(this.model.get("data_type")).addClass(c),this.model.set({data_type:c}),this.model.get("id")&&this.setsave(),!1},editContent:function(a){var b=this.$el.find(".item-content"),c=this.$el.find(".panel-buttons");return c.hide(),b.editable({autosave:!0,autosaveInterval:2500,inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","underline","strikeThrough","fontSize","fontFamily","color","sep","formatBlock","blockStyle","align","formatOL","formatUL","outdent","indent","sep","createLink","insertLink","insertImage","insertVideo","html","fullscreen","sep","close"],customButtons:{close:{title:"Close Editor",icon:{type:"font",value:"fa fa-close"},callback:function(){this.save(),this.destroy(),c.show()}}},imageUploadToS3:scFroalaS3,imageMaxSize:1048576}),b.on("editable.beforeSave",this,this.autosave),!1},autosave:function(a,b){var c=a.data,d=c.model.get("content");return d.raw=b.getHTML(),c.setsave({content:d}),!1},setsave:function(a,b){var c=this.$el.find(".item-content");if(c.data("fa.editable")){var d=this.model.get("content");d.raw=c.editable("getHTML"),this.model.set({content:d})}this.model.get("parent")||this.model.set("parent",StudyApp.CurrentChapter.model.get("id")),this.saving(),this.model.save(a,{success:this.saveSuccess,error:this.saveFail}),!1!==b&&StudyApp.CurrentChapter.model.fetch()},saving:function(){var a=this.$el.find(".item-content-save");a.addClass("saving")},saveSuccess:function(a,b,c){var d=a.$el.find(".item-content-save");d.removeClass("saving")},saveFail:function(a,b,c){var d=a.$el.find(".item-content-save");d.removeClass("saving"),alert("Saving failed... please refresh the page and try again."),console.log(b)},saveItem:function(a){return a.preventDefault(),!this.$el.find(".item-content-save").hasClass("saving")&&void this.setsave()},deleteItem:function(){if(window.confirm("Are you sure you want to delete this item?"))return this.model.destroy(),!1},handleDestroy:function(){this.remove(),StudyApp.CurrentChapter.model.fetch()}});var c=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-item":"createNewItem"},initialize:function(){this.listenTo(StudyApp.Collections.Item,"add",this.addItem),this.listenTo(StudyApp.Views.Chapter.Main,"renderChapter",this.setupItems)},setupItems:function(b){StudyApp.Collections.Item.reset();var c=b.get("elements");a.isEmptyObject(c)||(StudyApp.Collections.Item.add(b.get("elements")),StudyApp.Collections.Item.url=function(){return b.urlRoot()+b.id+"/items/"},this.$el.find("#chapter-items").sortable({handle:".item-reorder",update:this.sortItems}))},sortItems:function(){StudyApp.Collections.Item.each(function(a){a.get("menu_order")!=a.$el.index()&&a.save({menu_order:a.$el.index()})}),StudyApp.CurrentChapter.model.fetch()},addItem:function(a){var b=new StudyApp.Views.Item.List({model:a});a.$el=b.$el,this.$("#chapter-items").append(b.render().el),a.get("content")&&!a.get("content").rendered?b.editContent():b.compress()},createNewItem:function(a){return StudyApp.Collections.Item.add(new StudyApp.Models.Item),!1}});StudyApp.Views.Item.Main=new c}(jQuery);var StudyApp=StudyApp||{};!function(a){"use strict";var b=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){}});StudyApp.Views.Main=new b}(jQuery);