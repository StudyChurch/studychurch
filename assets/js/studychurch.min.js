/*! StudyChurch - v0.1.0 - 2016-01-06
 * http://wordpress.org/themes
 * Copyright (c) 2016; * Licensed GPLv2+ */
(function(e){"use strict";var t=function(e){var t=this;t.processing=!1,t.init=function(){t.$form=e,t.$form.length&&(t.$button=t.$form.find("input[type=submit]"),t.$form.on("submit",t.handleSubmission))},t.handleSubmission=function(e){return e.preventDefault(),t.processing?!1:(t.data={action:"sc_ajax_form",formdata:t.$form.serialize()},t.startProcessing(),wp.ajax.send("sc_ajax_form",{success:t.response,error:t.error,data:t.data}),void 0)},t.response=function(e){t.finishProcessing(e.message,!0),e.url&&(window.location=e.url)},t.error=function(e){t.finishProcessing("Ooops! Something went wrong, please try again.",!1),t.$form.prepend('<div class="alert-box alert" data-alert>'+e.message+"</div>"),console.log(e)},t.startProcessing=function(){t.processing=!0,t.$form.find(".alert-box").remove(),t.$button.val("Processing...").removeClass("secondary primary alert").addClass("processing secondary")},t.finishProcessing=function(e,n){t.processing=!1,t.$button.removeClass("processing secondary primary alert").val(e),n?t.$button.addClass("primary"):t.$button.addClass("alert")},t.init()};e(document).ready(function(){e(".ajax-form").each(function(){new t(e(this))})})})(jQuery),function(e,t){"use strict"}(jQuery,this),function(e,t){"use strict"}(jQuery,this),jQuery(document).ready(function(e){"use strict";var t=function(t){var n=this;n.$container=t,n.data={},n.init=function(){n.$form=t.find(".comment-form"),n.$answer=n.$form.find("textarea"),n.$save=n.$form.find(".sudo-save"),n.$container.on("click",".edit-answer",n.setupCommentForm),n.$container.on("click",".toggle-comments",n.toggleComments),n.$container.on("click",".toggle-answers",n.toggleAnswers),n.$save.on("click",n.triggerSubmission),n.$answer.on("keyup keydown",n.autoGrow),n.$form.on("submit",n.handleSubmission)},n.toggleComments=function(t){var n=e(t.target);return n.parents(".groups").toggleClass("comments-hide"),!1},n.toggleAnswers=function(t){var n=e(t.target);return n.parents(".activity-list-others").toggleClass("answers-hide"),!1},n.setupCommentForm=function(){return n.$container.find(".study-answers").remove(),n.$form.show().find("textarea").focus().select(),!1},n.autoGrow=function(e){var t=e.target;t.style.height=t.scrollHeight+"px"},n.triggerSubmission=function(e){return e.preventDefault,n.$form.submit(),n.$save.text("Saving"),!1},n.handleSubmission=function(e){e.preventDefault(),n.data.answer=n.$form.find("textarea[name=comment]").val(),n.data.post_id=n.$form.find("input[name=comment_post_ID]").val(),n.data.comment_id=n.$form.find("input[name=comment_ID]").val(),n.data.group_id=n.$form.find("input[name=group_ID]").val(),wp.ajax.send("sc_save_answer",{success:n.success,error:n.error,data:n.data})},n.success=function(e){n.$save.text("Save"),n.$form.find("input[name=comment_ID]").val(e.comment_ID),n.$form.hide(),n.$container.append(e.answers)},n.error=function(e){console.log("error"),console.log(e)},n.init()};e(document).ready(function(){e(".sc_study .study-answers-container").each(function(){new t(e(this))})})}),function(e,t){"use strict";t.sr=new scrollReveal,e(document).foundation(),e(document).ready(function(){e(document.getElementById("single-page-navigation")).singlePageNav(),e(".login a").attr("data-reveal-id","login"),e(".sign-up a").attr("data-reveal-id","start-now"),e(".fdatepicker").fdatepicker({format:"mm/dd/yyyy",disableDblClickSelection:!0}),e(".froala-min").editable({inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","underline","createLink"]}),e(".froala-default").editable({inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","underline","strikeThrough","sep","formatBlock","blockStyle","align","insertOrderedList","insertUnorderedList","outdent","indent","sep","createLink","html","fullscreen"]}),e(".froala-inline").editable({minHeight:100,buttons:["bold","italic","underline","strikeThrough","sep","formatBlock","blockStyle","align","insertOrderedList","insertUnorderedList","outdent","indent","sep","createLink"]}),e(".footer-subscribe #input_1_1").on("focus",function(){e(document).foundation(),e("#field_1_2").show()}),e(".group-invite-link").on("click",function(){e(this).select()}),e(".bug-report-button").on("click",function(){return e(this).parents(".bug-report-cont").find(".form").slideToggle(),!1});var t=e(document.getElementById("restricted-message"));if(t.length){var n=t.find("#login-body"),i=t.find("#start-now-body");n.find(".switch").on("click",function(){return n.fadeOut(function(){i.fadeIn()}),!1}),i.find(".switch").on("click",function(){return i.fadeOut(function(){n.fadeIn()}),!1})}})}(jQuery,this);var StudyApp=StudyApp||{};StudyApp.Models={},StudyApp.Views={},StudyApp.Collections={},StudyApp.$container=jQuery("#studyapp"),StudyApp.$content=jQuery("#studyapp-content"),StudyApp.study_id=StudyApp.$container.data("study"),StudyApp.user_id=StudyApp.$container.data("user"),StudyApp.chapter_id=null;var StudyApp=StudyApp||{};(function(e){"use strict";StudyApp.Collections.Chapter={},StudyApp.Views.Chapter={},StudyApp.Models.Chapter=Backbone.Model.extend({urlRoot:function(){return this.collection?this.collection.url():WP_API_Settings.root+"study/"+StudyApp.study_id+"/chapters/"},url:function(){return this.get("id")?this.urlRoot()+this.get("id"):this.urlRoot()},defaults:function(){return{ID:null,id:null,title:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.study_id,menu_order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),comment_status:"closed",ping_status:"closed",order:StudyApp.Collections.Chapter.Sidebar.nextOrder(),elements:{},sections:{}}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var i=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),i?i.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)}});var t=Backbone.Collection.extend({order:0,model:StudyApp.Models.Chapter,url:function(){return WP_API_Settings.root+"study/"+StudyApp.study_id+"/chapters/"},parse:function(e){return e},nextOrder:function(){return this.length?this.order=this.last().get("order")+1:this.order++,this.order},comparator:"order"});StudyApp.Collections.Chapter.Sidebar=new t,StudyApp.Collections.Chapter.Single=new t,StudyApp.Views.Chapter.Sidebar=Backbone.View.extend({tagName:"li",className:function(){return"page_item page-item_"+this.model.attributes.id},template:wp.template("chapter-sidebar-template"),events:{"click a":"setupSingle"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},setupSingle:function(){return StudyApp.CurrentChapter.remove(),StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:this.model}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model),!1}}),StudyApp.Views.Chapter.Single=Backbone.View.extend({tagName:"div",className:"chapter",template:wp.template("chapter-template"),events:{"blur .chapter-title":"saveTitle","click .chapter-delete":"deleteChapter"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},saveTitle:function(t){this.$el.find(".chapter-title").removeClass("editing");var n=e(t.target).val();n&&this.model.save({title:n})},deleteChapter:function(){return window.confirm("Are you sure you want to delete this chapter and all its items?")?(this.model.$el.remove(),this.model.destroy(),!1):void 0},render:function(){return StudyApp.chapter_id=this.model.get("id"),this.$el.html(this.template(this.model.toJSON())),this}});var n=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){StudyApp.$container.length&&(this.listenTo(StudyApp.Collections.Chapter.Sidebar,"add",this.addSidebarChapter),this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.fetch())},addSidebarChapter:function(e){var t=new StudyApp.Views.Chapter.Sidebar({model:e});e.$el=t.$el,this.$("#chapter-list").append(t.render().el),this.$("#chapter-list").sortable({update:this.sortChapters})},sortChapters:function(){StudyApp.Collections.Chapter.Sidebar.each(function(e){e.get("menu_order")!=e.$el.index()&&e.save({menu_order:e.$el.index()})})},initializeChapterEdit:function(e){StudyApp.CurrentChapter=new StudyApp.Views.Chapter.Single({model:e}),StudyApp.$content.html(StudyApp.CurrentChapter.render().el),StudyApp.Views.Chapter.Main.trigger("renderChapter",StudyApp.CurrentChapter.model)},createNewChapter:function(){return this.listenToOnce(StudyApp.Collections.Chapter.Sidebar,"add",this.initializeChapterEdit),StudyApp.Collections.Chapter.Sidebar.add(new StudyApp.Models.Chapter),!1}});StudyApp.Views.Chapter.Main=new n})(jQuery);var StudyApp=StudyApp||{};(function(e){"use strict";StudyApp.Collections.Item={},StudyApp.Views.Item={},StudyApp.Models.Item=Backbone.Model.extend({urlRoot:function(){return this.collection.url()},url:function(){return this.attributes.id?this.urlRoot()+this.get("id"):this.urlRoot()},defaults:function(){return{ID:null,id:null,title:{rendered:""},content:{rendered:""},status:"publish",type:"sc_study",author:StudyApp.user_id,parent:StudyApp.CurrentChapter.model.get("id"),menu_order:StudyApp.Collections.Item.nextOrder(),comment_status:"open",ping_status:"closed",data_type:"question_short",is_private:!1}},sync:function(e,t,n){if(n=n||{},WP_API_Settings.nonce!==void 0){var i=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce),i?i.apply(this,arguments):void 0}}return Backbone.sync(e,t,n)}});var t=Backbone.Collection.extend({menu_order:0,model:StudyApp.Models.Item,url:function(){return WP_API_Settings.root+"study/"+StudyApp.study_id+"/chapters/"+StudyApp.CurrentChapter.model.get("id")+"/items/"},nextOrder:function(){return this.length?this.menu_order=this.last().get("menu_order")+1:this.menu_order++,this.menu_order},comparator:"menu_order"});StudyApp.Collections.Item=new t,StudyApp.Views.Item.List=Backbone.View.extend({tagName:"li",className:function(){return"panel item-"+this.model.get("id")+" "+this.model.get("data_type")},template:wp.template("item-template"),events:{"click .item-compress":"compress","click .item-expand":"expand","click .item-content-edit":"editContent","click .item-content-delete":"deleteItem","click .item-content-save":"saveItem","click .item-privacy":"setPrivacy","change .item-data-type":"setDataType"},initialize:function(){this.listenTo(this.model,"destroy",this.handleDestroy),this.listenTo(this.model,"save",this.handleDestroy)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},compress:function(){return this.$el.addClass("compressed"),!1},expand:function(){return this.$el.removeClass("compressed"),!1},setPrivacy:function(t){var n=e(t.target);if(n.hasClass("item-privacy")||(n=n.parent()),"question_short"!=this.model.get("data_type")&&"question_long"!=this.model.get("data_type"))return!1;if(n.hasClass("current"))return!1;this.$el.find(".item-privacy").removeClass("current"),n.addClass("current");var i=n.hasClass("item-private");return this.model.set({is_private:i}),this.model.get("id")&&this.setsave(),!1},setDataType:function(t){var n=e(t.target).val();return this.$el.removeClass(this.model.get("data_type")).addClass(n),this.model.set({data_type:n}),this.model.get("id")&&this.setsave(),!1},editContent:function(){var e=this.$el.find(".item-content"),t=this.$el.find(".panel-buttons");return t.hide(),e.editable({autosave:!0,autosaveInterval:2500,inlineMode:!1,minHeight:100,maxHeight:400,buttons:["bold","italic","underline","strikeThrough","fontSize","fontFamily","color","sep","formatBlock","blockStyle","align","formatOL","formatUL","outdent","indent","sep","createLink","insertLink","insertImage","insertVideo","html","fullscreen","sep","close"],customButtons:{close:{title:"Close Editor",icon:{type:"font",value:"fa fa-close"},callback:function(){this.save(),this.destroy(),t.show()}}},imageUploadToS3:scFroalaS3,imageMaxSize:1048576}),e.on("editable.beforeSave",this,this.autosave),!1},autosave:function(e,t){var n=e.data,i=n.model.get("content");return i.raw=t.getHTML(),n.setsave({content:i}),!1},setsave:function(e,t){var n=this.$el.find(".item-content");if(n.data("fa.editable")){var i=this.model.get("content");i.raw=n.editable("getHTML"),this.model.set({content:i})}this.model.get("parent")||this.model.set("parent",StudyApp.CurrentChapter.model.get("id")),this.saving(),this.model.save(e,{success:this.saveSuccess,error:this.saveFail}),!1!==t&&StudyApp.CurrentChapter.model.fetch()},saving:function(){var e=this.$el.find(".item-content-save");e.addClass("saving")},saveSuccess:function(e){var t=e.$el.find(".item-content-save");t.removeClass("saving")},saveFail:function(e,t){var n=e.$el.find(".item-content-save");n.removeClass("saving"),alert("Saving failed... please refresh the page and try again."),console.log(t)},saveItem:function(e){return e.preventDefault(),this.$el.find(".item-content-save").hasClass("saving")?!1:(this.setsave(),void 0)},deleteItem:function(){return window.confirm("Are you sure you want to delete this item?")?(this.model.destroy(),!1):void 0},handleDestroy:function(){this.remove(),StudyApp.CurrentChapter.model.fetch()}});var n=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-item":"createNewItem"},initialize:function(){this.listenTo(StudyApp.Collections.Item,"add",this.addItem),this.listenTo(StudyApp.Views.Chapter.Main,"renderChapter",this.setupItems)},setupItems:function(t){StudyApp.Collections.Item.reset();var n=t.get("elements");e.isEmptyObject(n)||(StudyApp.Collections.Item.add(t.get("elements")),StudyApp.Collections.Item.url=function(){return t.urlRoot()+t.id+"/items/"},this.$el.find("#chapter-items").sortable({handle:".item-reorder",update:this.sortItems}))},sortItems:function(){StudyApp.Collections.Item.each(function(e){e.get("menu_order")!=e.$el.index()&&e.save({menu_order:e.$el.index()})}),StudyApp.CurrentChapter.model.fetch()},addItem:function(e){var t=new StudyApp.Views.Item.List({model:e});e.$el=t.$el,this.$("#chapter-items").append(t.render().el),e.get("content")&&!e.get("content").rendered?t.editContent():t.compress()},createNewItem:function(){return StudyApp.Collections.Item.add(new StudyApp.Models.Item),!1}});StudyApp.Views.Item.Main=new n})(jQuery);var StudyApp=StudyApp||{};(function(){"use strict";var e=Backbone.View.extend({el:StudyApp.$container,events:{"click #new-chapter":"createNewChapter"},initialize:function(){}});StudyApp.Views.Main=new e})(jQuery);